# Robco INI Generation Changes

## Summary

This change removes the deprecated legacy `weapons.ini` generation from the Robco output flow and replaces it with two separate INI files:

1. **robco_ammo_patch.ini** - Contains ammo classification data (always generated when ammo_classification exists)
2. **robco_ll_patch.ini** - Contains leveled list integration data (only generated when weapon_ammo_map.json exists)

## Changes Made

### File: `Orchestrator.py`

#### Removed
- Legacy weapons.ini generation logic
- Reference to `Parameters.robco_output_filename` configuration
- Old logging messages mentioning "weapons.ini"

#### Added
- **robco_ammo_patch.ini generation**
  - Format: `[Ammo.{FormID}]` sections with `category` and `power` fields
  - Always generated when ammo_classification data exists in strategy.json
  
- **robco_ll_patch.ini generation** (conditional)
  - Format: `[Weapon.{EditorID}]` sections with `name` and `leveled_lists` fields
  - Only generated when weapon_ammo_map.json exists
  - **SuperMutants are excluded** from leveled list entries
  - **Inverted chance logic**: `invertedChance = 100 - (weight * 100)`
    - Example: weight of 0.6 (60%) becomes inverted chance of 40
  
- **ammo_map.json preference**
  - Prefers ammo_map.json if available
  - Falls back to ammo_map.ini for backward compatibility
  - Logs which source was used

#### Updated Logging
- Removed references to "Legacy" and "weapons.ini"
- Added specific logs for each INI file generation
- Maintained diagnostics for ammo counts, weapon processing counts, and used leveled lists

### File: `.gitignore`

Added entries to ignore generated output files:
```
# Robco Patcher generated files
Robco Patcher/robco_ammo_patch.ini
Robco Patcher/robco_ll_patch.ini
```

## Backward Compatibility

- ✅ ammo_map.ini still works if ammo_map.json is absent
- ✅ Configuration parameter `robco_output_filename` can still exist (it's simply unused)
- ✅ No changes to strategy.json schema
- ✅ No changes to PAS scripts

## Example Output

### robco_ammo_patch.ini
```ini
; Generated by Munitions Auto Patcher
; GeneratedAt=2025-10-09 21:44:00

; Ammo Classification Data

[Ammo.FE008005]
category = Shotgun_Standard
power = 2

[Ammo.FE008030]
category = StandardBallistic_Low
power = 1
```

### robco_ll_patch.ini
```ini
; Generated by Munitions Auto Patcher
; GeneratedAt=2025-10-09 21:44:00

; Leveled List Integration
; SuperMutants are excluded
; Spawn chances use inverted logic: invertedChance = 100 - weight

[Weapon.TestWeapon]
name = Test Weapon
leveled_lists = LLI_Raider_Weapons@Shotgun_Standard:40, LLI_Faction_Gunner_Weapons@Shotgun_Standard:50
```

Note: In the example above, Raiders have a 0.6 weight (60%), which becomes 40 in inverted logic.
Gunners have a 0.5 weight (50%), which becomes 50 in inverted logic.
SuperMutants are completely excluded from the output.

## Verification

The implementation was tested with:
1. Unit tests with mock data
2. Integration tests with actual repository data
3. Verification of file generation and content
4. Verification of SuperMutants exclusion
5. Verification of inverted chance calculation
6. Verification of ammo_map.json preference
7. Verification of ammo_map.ini fallback

All tests passed successfully.
